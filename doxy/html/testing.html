<!-- HTML header for doxygen 1.8.12-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TSDuck: Testing TSDuck</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxy-style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img src="tsduck-32.png"/></td>
   <td id="projectalign"><span id="projectname">TSDuck</span>
    <span id="projectnumber">Version 3.7</span>
    <span id="projectbrief">(TSDuck - The MPEG Transport Stream Toolkit)</span>
   </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('testing.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Testing TSDuck </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#testoverview">Testing overview</a></li>
<li class="level1"><a href="#testorg">Organization of the tests</a></li>
<li class="level1"><a href="#testlib">The TSDuck library test suite</a></li>
<li class="level1"><a href="#testtools">The TSDuck tools and plugins test suite</a><ul><li class="level2"><a href="#teststruct">Structure of the test suite</a></li>
<li class="level2"><a href="#testadd">Adding new tests</a></li>
<li class="level2"><a href="#testdev">Testing a development version</a></li>
<li class="level2"><a href="#testlargefiles">Large files</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="testoverview"></a>
Testing overview</h1>
<p>TSDuck is highly flexible, allowing an unlimited number of configurations. Testing it is consequently challenging. Moreover, some use cases are difficult to automate or require specific hardware. Testing live TS reception using all possible DVB tuners or Dektec devices requires a lot of material, human and time resources which are far beyond the capabilities of a free open-source project.</p>
<p>From a strict industrial standpoint, TSDuck is consequently not fully tested.</p>
<p>However, on a pragmatic standpoint, test suites have been setup to extract the best of what could be done with limited resources.</p>
<p>Thus, although it is impossible to guarantee that a given release of TSDuck is bug-free, we may be relatively confident that no major regression has been introduced.</p>
<h1><a class="anchor" id="testorg"></a>
Organization of the tests</h1>
<p>The code of TSDuck is divided in two parts, a large C++ library (<code>tsduck.dll</code> or <code>tsduck.so</code>) and a collection of small command line tools and plugins.</p>
<p>Similarly, the tests for TSDuck are divided in two parts.</p>
<ul>
<li>The TSDuck library has its own unitary test suite based on CppUnit. This test suite is part of the <a href="https://github.com/tsduck/tsduck">main tsduck</a> repository for TSDuck in directory <code>src/utest</code>.</li>
<li>The tools and plugins are less easy to test. They work on large transport stream files which would clutter the tsduck repository. The repository <a href="https://github.com/tsduck/tsduck-test">tsduck-test</a> contains those tests and the relevant scripts and data files.</li>
</ul>
<p>The two test suites are fully automated.</p>
<h1><a class="anchor" id="testlib"></a>
The TSDuck library test suite</h1>
<p>In the main TSDuck repository, the directory <code>src/utest</code> contains the source file for one single program named <code>utest</code>. This program is divided in many source files (or test suites). Each source file contains many unitary tests. The test infrastructure is based on CppUnit.</p>
<p>The <code>utest</code> executable is built twice, once using the TSDuck shared library and once using the static library. On UNIX systems, both versions of the test suite are built and run using <code>make test</code> as illustrated below </p><div class="fragment"><div class="line">$ make test</div><div class="line">  .....</div><div class="line">  [LD] release-x86_64/utest</div><div class="line">  [LD] release-x86_64/utest_static</div><div class="line">source release-x86_64/setenv.sh &amp;&amp; release-x86_64/utest</div><div class="line"></div><div class="line"></div><div class="line">OK (310 tests)</div><div class="line"></div><div class="line"></div><div class="line">source release-x86_64/setenv.sh &amp;&amp; release-x86_64/utest_static</div><div class="line"></div><div class="line"></div><div class="line">OK (307 tests)</div><div class="line"></div><div class="line"></div><div class="line">$ </div></div><!-- fragment --><p>Note that the statically linked version contains slightly less tests. The missing tests are related to plugin activations and they can run only in a shared library environment.</p>
<p>On Windows, the Visual Studio project builds two executables named <code>utests-tsduckdll.exe</code> and <code>utests-tsducklib.exe</code>. They can be run manually or from Vidual Studio:</p>
<div class="fragment"><div class="line">D:\Devel\tsduck&gt; build\msvc2017\Release-x64\utests-tsduckdll.exe</div><div class="line"></div><div class="line"></div><div class="line">OK (311 tests)</div><div class="line"></div><div class="line"></div><div class="line">D:\Devel\tsduck&gt; build\msvc2017\Release-x64\utests-tsducklib.exe</div><div class="line"></div><div class="line"></div><div class="line">OK (308 tests)</div><div class="line"></div><div class="line"></div><div class="line">D:\Devel\tsduck&gt;</div></div><!-- fragment --><p>By default, the test program runs all tests and reports failures only. But <code>utest</code> also accepts a few command options which make it appropriate to debug individual features.</p>
<p>The available command line options are:</p>
<ul>
<li><code>-a</code> : Automated test mode, default XML file: <code>tsduck-Results.xml</code>.</li>
<li><code>-d</code> : Debug messages are output on standard error.</li>
<li><code>-l</code> : List all tests but do not execute them.</li>
<li><code>-n</code> : Normal basic mode (default).</li>
<li><code>-o name</code> : Output file prefix with <code>-a</code>, <code>-Results.xml</code> is added to the prefix.</li>
<li><code>-s</code> : Silent mode, same as <code>-n</code>, for compatibility with CUnit.</li>
<li><code>-t name</code> : Run only one test or test suite (use <code>-l</code> for test list).</li>
<li><code>-v</code> : Verbose mode, same as <code>-n</code>, for compatibility with CUnit.</li>
</ul>
<p>First, the option <code>-l</code> is used to list all available tests:</p>
<div class="fragment"><div class="line">$ utest -l</div><div class="line">AlgorithmTest</div><div class="line">    AlgorithmTest::testEnumerateCombinations</div><div class="line">ArgsTest</div><div class="line">    ArgsTest::testAccessors</div><div class="line">    ArgsTest::testHelp</div><div class="line">........</div><div class="line">    WebRequestTest::testInvalidURL</div><div class="line">XMLTest</div><div class="line">    XMLTest::testDocument</div><div class="line">    XMLTest::testInvalid</div><div class="line">    XMLTest::testFileBOM</div><div class="line">    XMLTest::testValidation</div><div class="line">    XMLTest::testCreation</div><div class="line">    XMLTest::testKeepOpen</div><div class="line">$</div></div><!-- fragment --><p>The left-most names are test suite names. They represent one source file in <code>src/utest</code>. It is possible to run all tests in a test suite or one specific test.</p>
<div class="fragment"><div class="line">$ utest -t ArgsTest</div><div class="line">$ utest -t XMLTest::testValidation</div></div><!-- fragment --><p>The option <code>-d</code> is used to produce debug message (see examples in the test source files).</p>
<p>Thus, <code>utest</code> alone can be used as an automated fairly complete non-regression test suite for the TSDuck library or as a debug environment for a given feature under development (in all good "test-driven development" approaches, the code is written at the same time as its unitary test).</p>
<h1><a class="anchor" id="testtools"></a>
The TSDuck tools and plugins test suite</h1>
<p>The Git repository <a href="https://github.com/tsduck/tsduck-test">tsduck-test</a> contains some tests for the TSDuck tools and plugins. This test suite is currently less exhaustive that the TSDuck library test suite and it should be enriched in the future.</p>
<p>This test suite is fully automated and works on test files only. No specific hardware (DVB tuner or Dektec device), no live stream is tested. This is a known limitation.</p>
<p>The principle is simple. Reference input files are stored in the repository, mainly transport stream files which were once captured from real live sources. Test scripts contain deterministic commands which should always produce the same outputs (data, logs, etc). These reference outputs are also stored in the repository.</p>
<p>The test suite runs using a given version of TSDuck and its outputs are compared with the reference outputs. If differences are detected, there is a potential problem.</p>
<p>Since different versions of TSDuck may produce slightly different outputs, a given version of the test suite formally applies to one version of TSDuck only. Git tags are aligned in both repositories (or should be...) to indicate the target version.</p>
<h2><a class="anchor" id="teststruct"></a>
Structure of the test suite</h2>
<p>In short, execute the script <code>run-all-tests.sh</code> to run the complete test suite.</p>
<p>The repository contains the following subdirectories:</p>
<ul>
<li><code>tests</code> : Contains one script per test or set of tests. Each test script can be executed individually. All tests are executed using the script <code>run-all-tests.sh</code>.</li>
<li><code>common</code> : Contains utilities and common script.</li>
<li><code>input</code> : Contains input data files for the tests.</li>
<li><code>reference</code> : Contains reference output files for the various tests.</li>
<li><code>tmp</code> : Contains output files which are created by the execution of the tests. These files are typically compared against reference output files in <code>reference</code>. These files are temporary by definition. The subdirectory <code>tmp</code> is present on test machines only and is excluded from the Git repository.</li>
</ul>
<h2><a class="anchor" id="testadd"></a>
Adding new tests</h2>
<p>To add a new test:</p>
<ul>
<li>Add input files in subdirectory <code>input</code>.</li>
<li>Create the script <code>test-NNN.sh</code> in subdirectory <code>tests</code>. Use other existing test scripts as templates.</li>
<li>Run the command <code>tests/test-NNN.sh --init</code>. If the test is properly written, this creates the reference output files in subdirectory <code>reference</code>. Manually check the created files, verify that they are correct. Be careful with this step since these files will be used as references.</li>
<li>Run the same command without the <code>--init</code> option. This time, the output files are created in <code>tmp</code> and are compared with files in <code>reference</code>. Verify that all tests pass. Errors may appear if the test script is not properly written or if the output files contain unique, non-deterministic, time-dependent, system-dependent or file-system-dependent information. Make sure the output files are totally reproduceable in all environments. At worst, add code in the test script to remove any information from the output files which is known to be non-reproduceable.</li>
</ul>
<p>Sometimes, TSDuck is modified in such in a way that an output file is modified on purpose. Usually, this starts with a failed test. When analysing the test failure, it appears that the modification of the output is intentional. In that case, re-run the command <code>tests/test-NNN.sh --init</code> to update the reference output files. Do not forget to manually validate them since they will act as the new reference.</p>
<h2><a class="anchor" id="testdev"></a>
Testing a development version</h2>
<p>By default, the test suite uses the TSDuck command from the system path. Typically, it will use the installed version.</p>
<p>To test a development version, the two Git repositories <code>tsduck</code> and <code>tsduck-test</code> shall be checked out at the same level, side by side in the same directory. First, TSDuck shall be rebuilt in its repository.</p>
<p>Then, when the option <code>--dev</code> is specified to a test script or to <code>run-all-tests.sh</code>, the test suite automatically uses the TSDuck executables from the development repository.</p>
<h2><a class="anchor" id="testlargefiles"></a>
Large files</h2>
<p>The <code>tsduck-test</code> repository contains large files, typically transport stream files.</p>
<p>Initially, these files were not stored inside the regular GitHub repository. Instead, they used the <a href="https://git-lfs.github.com">Git Large File Storage</a> (LFS) feature of GitHub. However, using LFS on GitHub happended to be a pain, as experienced by others and explained in <a href="https://medium.com/@megastep/github-s-large-file-storage-is-no-panacea-for-open-source-quite-the-opposite-12c0e16a9a91">this article</a>.</p>
<p>As a consequence, the transport stream files were re-integrated into the Git repository. But we now limit their size to 20 MB. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.12-->
<!-- start footer part -->
</body>
</html>
